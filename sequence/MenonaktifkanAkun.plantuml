@startuml
' === Styling ===
skinparam sequence {
    LifelineFooterStrategy none
    MessageAlign center
    ArrowThickness 1
    ParticipantPadding 20
    GroupBorderThickness 0.5
    GroupBackgroundColor #F9F9F9
}
hide footbox

' === Participants ===
actor Admin
participant "Users Page (Next.js FE)" as FE
participant "UserController (Laravel BE)" as BE
database "Database (PostgreSQL)" as DB
participant "EmailService (Laravel BE)" as ES

' === Akses Data Pengguna ===
    Admin -> FE: Klik menu "Users" pada navbar
    activate FE
    FE -> BE: GET /api/users
    activate BE
    BE -> DB: Ambil daftar seluruh pengguna beserta status
    activate DB
    DB --> BE: Return list of users
    deactivate DB
    BE --> FE: 200 OK (Daftar pengguna)
    deactivate BE
    FE -> Admin: Tampilkan tabel daftar pengguna dengan status terkini
    deactivate FE

' === Proses Penonaktifan Akun ===
    Admin -> FE: Klik tombol "Deactivate" pada kolom Action
    activate FE

    ' === Validasi di frontend ===
    FE -> FE: Validasi status akun (aktif dan dapat dinonaktifkan)
    activate FE #LightBlue
    deactivate FE #LightBlue

    FE -> Admin: Tampilkan pop-up konfirmasi penonaktifan akun pengguna
    deactivate FE

    alt Admin konfirmasi "Continue"
        Admin -> FE: Klik "Continue"
        activate FE
        FE -> BE: PUT /api/users/{id}/deactivate
        activate BE
        BE -> DB: Update status akun pengguna menjadi "Deactivated"
        activate DB

        alt Penonaktifan berhasil
            DB --> BE: OK (Status updated)
            ' === Kirim notifikasi ke pengguna terkait ===
            BE -> ES: Kirim email notifikasi penonaktifan akun
            activate ES
            ES -> ES: Kirim email ke alamat email pengguna
            activate ES #LightBlue
            deactivate ES #LightBlue
            deactivate ES

            BE --> FE: 200 OK ("User account deactivated successfully")
            deactivate BE

            FE -> FE: Perbarui daftar pengguna di UI
            activate FE #LightBlue
            deactivate FE #LightBlue

            FE -> Admin: Tampilkan toast "User account deactivated successfully"
            deactivate FE



        else Gagal memperbarui status
            DB --> BE: Error (Update failed)
            deactivate DB
            activate BE
            BE --> FE: 500 Internal Server Error ("Failed to deactivate account")
            deactivate BE
            activate FE
            FE -> Admin: Tampilkan toast "Failed to terminate account. Please try again"
            deactivate FE
        end

    else Admin membatalkan konfirmasi
        Admin -> FE: Klik "Cancel"
        activate FE
        FE -> Admin: Tutup pop-up, data pengguna tetap tersimpan
        deactivate FE
    end

@enduml