@startuml
' === Styling ===
skinparam sequence {
    LifelineFooterStrategy none
    MessageAlign center
    ArrowThickness 1
    ParticipantPadding 20
    GroupBorderThickness 0.5
    GroupBackgroundColor #F9F9F9
}
hide footbox

' === Participants ===
actor Pengguna
participant "Post Detail Page (Next.js FE)" as FE
participant "LikeController (Laravel BE)" as BE
database "Database (PostgreSQL)" as DB
participant "NotificationService (Laravel BE)" as NS
actor "Pengguna (Pemilik Post)" as FE_Adopter

' === Flow 1: Membuka Halaman Detail Post ===
Pengguna -> FE: Buka halaman detail postingan
activate FE
FE -> BE: GET /api/posts/{post_id}/likes/status
deactivate FE
activate BE
BE -> DB: Ambil status Like dan jumlah total Like untuk post_id
activate DB
DB --> BE: Return like status & like count / null
deactivate DB

    BE --> FE: 200 OK (like status & like count)
    deactivate BE
    activate FE
    FE -> Pengguna: Tampilkan ikon Like dan jumlah Like
    deactivate FE


' === Flow 2: Mengklik Ikon Like ===
Pengguna -> FE: Klik ikon "Like"
activate FE
FE -> BE: POST /api/posts/{post_id}/like
deactivate FE
activate BE
deactivate DB

    BE -> DB: Simpan data Like untuk post_id dan user_id
alt Pengguna belum memberi Like
    activate DB
    DB --> BE: Success (Like added)
    BE -> NS: Broadcast event "MessageSent" ke channel "notification.{user_id}
    activate NS
    NS -> FE_Adopter: Push notification "New like on your post"
    NS --> BE: Event broadcasted
    deactivate NS
    BE --> FE: 200 OK ("Liked", new like count)
    deactivate BE
    activate FE
    FE -> Pengguna: Perbarui ikon (aktif) dan tambah 1 pada jumlah Like
    deactivate FE

else Pengguna sudah memberi Like
    DB --> BE: Success (Like removed)
    activate BE
    BE --> FE: 200 OK ("Unliked", new like count)
    deactivate BE
    activate FE
    FE -> Pengguna: Perbarui ikon (non-aktif) dan kurangi 1 pada jumlah Like
    deactivate FE

' === Alternate Flow: Gagal Memperbarui Status Like ===
else Gagal memperbarui status Like
    DB --> BE: Error (e.g., constraint violation / data not found / connection failure)
    deactivate DB
    activate BE
    BE --> FE: 500 Internal Server Error ("Failed to update like")
    deactivate BE
    activate FE
    FE -> Pengguna: Tampilkan pesan "Failed to update like. Please try again."
    deactivate FE
end

@enduml