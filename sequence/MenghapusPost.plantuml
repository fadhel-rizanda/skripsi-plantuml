@startuml
' === Styling ===
skinparam sequence {
    LifelineFooterStrategy none
    MessageAlign center
    ArrowThickness 1
    ParticipantPadding 20
    GroupBorderThickness 0.5
    GroupBackgroundColor #F9F9F9
}
hide footbox

' === Participants ===
actor Admin
actor Pengguna
participant "Posts Page (Next.js FE)" as FE
participant "PostController (Laravel BE)" as BE
database "Database (PostgreSQL)" as DB
participant "NotificationService  (Laravel BE)" as NS

' === Flow A: Admin Menghapus Post ===
group Admin Menghapus Post
    Admin -> FE: Klik menu "Posts" pada navbar
    activate FE
    FE -> BE: GET /api/posts
    activate BE
    BE -> DB: Ambil daftar seluruh post
    activate DB
    DB --> BE: Return list of posts
    deactivate DB
    BE --> FE: 200 OK (Daftar post)
    deactivate BE
    FE -> Admin: Tampilkan tabel daftar post dengan status terkini
    deactivate FE

    Admin -> FE: Klik tombol "Takedown" pada post tertentu
    activate FE
    FE -> Admin: Tampilkan pop-up konfirmasi penghapusan post
    deactivate FE

    alt Admin konfirmasi "Continue"
        Admin -> FE: Klik "Continue"
        activate FE
        FE -> BE: DELETE /api/posts/{id}
        deactivate FE
        activate BE
        BE -> DB: Hapus data post berdasarkan ID
        deactivate BE
        activate DB

        alt Penghapusan berhasil
            DB --> BE: Success (Row deleted)
            activate BE
            ' Kirim notifikasi ke Creator post
            BE -> NS: Broadcast event "MessageSent" ke channel "notification.{user_id}
            activate NS
            NS -> Pengguna: Push notification "Your post has been taken down by admin"
            NS --> BE: Event broadcasted
            deactivate NS
            BE --> FE: 200 OK ("Post deleted successfully")
            deactivate BE
            activate FE
            FE -> FE: Perbarui daftar post di UI
            activate FE #LightBlue
            deactivate FE #LightBlue
            FE -> Admin: Tampilkan pesan "Post deleted successfully"
            deactivate FE


        else Gagal menghapus data
            DB --> BE: Error (e.g., data not found / connection failure)
            deactivate DB
            activate BE
            BE --> FE: 500 Internal Server Error ("Failed to delete post")
            deactivate BE
            activate FE
            FE -> Admin: Tampilkan pesan "Failed to delete post. Please try again."
            deactivate FE
        end

    else Admin membatalkan konfirmasi
        Admin -> FE: Klik "Cancel"
        activate FE
        FE -> Admin: Tutup pop-up, data post tetap tersimpan
        deactivate FE
    end
end


' === Flow B: User Menghapus Post ===
group Pengguna Menghapus Post
    Pengguna -> FE: Buka halaman detail post
    activate FE
    FE -> BE: GET /api/posts/{id}
    activate BE
    BE -> DB: Ambil detail post berdasarkan ID
    activate DB
    DB --> BE: Return post details
    deactivate DB
    BE --> FE: 200 OK (Post details)
    deactivate BE
    FE -> FE: Cek apakah creator = user saat ini
    activate FE #LightBlue
    deactivate FE #LightBlue
    FE -> Pengguna: Tampilkan detail post (dengan tombol "Takedown" jika creator)
    deactivate FE

    Pengguna -> FE: Klik tombol "Takedown"
    activate FE
    FE -> Pengguna: Tampilkan pop-up konfirmasi penghapusan
    deactivate FE

    alt Pengguna konfirmasi "Continue"
        Pengguna -> FE: Klik "Continue"
        activate FE
        FE -> BE: DELETE /api/posts/{id}
        deactivate FE
        activate BE
        BE -> DB: Hapus data post berdasarkan ID
        deactivate BE
        activate DB

        alt Penghapusan berhasil
            DB --> BE: Success (Row deleted)
            activate BE
            BE --> FE: 200 OK ("Post deleted successfully")
            deactivate BE
            activate FE
            FE -> FE: Redirect ke halaman daftar post
            activate FE #LightBlue
            deactivate FE #LightBlue
            FE -> Pengguna: Tampilkan pesan "Post deleted successfully"
            deactivate FE

        else Gagal menghapus data
            DB --> BE: Error (e.g., data not found / connection failure)
            deactivate DB
            activate BE
            BE --> FE: 500 Internal Server Error ("Failed to delete post")
            deactivate BE
            activate FE
            FE -> Pengguna: Tampilkan pesan "Failed to delete post. Please try again."
            deactivate FE
        end

    else Pengguna membatalkan konfirmasi
        Pengguna -> FE: Klik "Cancel"
        activate FE
        FE -> Pengguna: Tutup pop-up, data post tetap tersimpan
        deactivate FE
    end
end

@enduml
