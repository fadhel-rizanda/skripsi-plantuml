@startuml
' === Styling ===
skinparam sequence {
    LifelineFooterStrategy none
    MessageAlign center
    ArrowThickness 1
    ParticipantPadding 20
    GroupBorderThickness 0.5
    GroupBackgroundColor #F9F9F9
}
hide footbox

' === Participants ===
actor Admin
participant "Adoption Process Page (Next.js FE)" as FE
participant "AdoptionProcessController (Laravel BE)" as BE
database "Database (PostgreSQL)" as DB
participant "NotificationService (Laravel BE)" as NS
actor "Pengguna (Calon Pengadopsi & Penyedia Hewan)" as FE_Adopter

    alt Flow A: Akses Melalui  Daftar Proses Adopsi
        Admin -> FE: Klik menu "Adoption Process" pada navbar
        activate FE
        FE -> BE: GET /api/adoptions
        activate BE
        BE -> DB: Ambil daftar seluruh proses adopsi
        activate DB
        DB --> BE: Return list of adoption processes
        deactivate DB
        BE --> FE: 200 OK (Daftar proses adopsi)
        deactivate BE
        FE -> Admin: Tampilkan tabel daftar proses adopsi dengan status terkini
        deactivate FE

    else Flow B: Akses Melalui Halaman Detail
        Admin -> FE: Buka halaman detail proses adopsi
        activate FE
        FE -> BE: GET /api/adoptions/{id}
        activate BE
        BE -> DB: Ambil detail proses adopsi berdasarkan ID
        activate DB
        DB --> BE: Return adoption process details
        deactivate DB
        BE --> FE: 200 OK (Adoption process details)
        deactivate BE
        FE -> Admin: Tampilkan halaman detail dengan tombol "Reject"
        deactivate FE
    end

    Admin -> FE: Klik tombol "Reject"
    activate FE

    ' === Validasi di frontend ===
    FE -> FE: Validasi status proses (belum Approved/Rejected)
    activate FE #LightBlue
    deactivate FE #LightBlue

    FE -> Admin: Tampilkan pop-up konfirmasi penolakan
    deactivate FE

    alt Admin konfirmasi "Continue"
        Admin -> FE: Klik "Continue"
        activate FE
        FE -> BE: PUT /api/adoptions/{id}/reject
        activate BE
        BE -> DB: Update status proses adopsi menjadi "Rejected"
        activate DB

        alt Penolakan berhasil
            DB --> BE: OK (Status updated)
            ' === Kirim notifikasi ke pihak terkait ===
            BE -> NS: Broadcast event "MessageSent" ke channel "chat.{room_id}"
            activate NS
            NS -> FE_Adopter: Push notification "Your adoption process has been rejected by admin"
            deactivate NS
            BE --> FE: 200 OK ("Adoption process rejected successfully")
            deactivate BE

            FE -> Admin: Tampilkan pesan "Adoption process rejected successfully"
            deactivate FE

        else Gagal memperbarui status
            DB --> BE: Error (Update failed)
            deactivate DB
            activate BE
            BE --> FE: 500 Internal Server Error ("Failed to reject adoption process")
            deactivate BE
            activate FE
            FE -> Admin: Tampilkan pesan "Failed to reject adoption process. Please try again."
            deactivate FE
        end

    else Admin membatalkan konfirmasi
        Admin -> FE: Klik "Cancel"
        activate FE
        FE -> Admin: Tutup pop-up, tidak ada perubahan
        deactivate FE
    end

@enduml