@startuml
' === Styling ===
skinparam sequence {
    LifelineFooterStrategy none
    MessageAlign center
    ArrowThickness 1
    ParticipantPadding 20
    GroupBorderThickness 0.5
    GroupBackgroundColor #F9F9F9
}
hide footbox

' === Participants ===
actor "Calon Pengadopsi" as Adopter
participant "Pet Detail Page (Next.js FE)" as FE
participant "AdoptionController (Laravel BE)" as BE
database "Database (PostgreSQL)" as DB
participant "NotificationService (Laravel BE)" as NS
actor "Penyedia Hewan" as FE_Adopter

title Mengadopsi Hewan (Overview)

' === Flow 1: Memulai Proses Adopsi ===
Adopter -> FE: Klik tombol "Adopt Me" pada detail hewan
activate FE
FE -> BE: POST /api/adoptions {pet_id, user_id}
deactivate FE
activate BE

alt Validasi berhasil (profile lengkap & pet tersedia)
    BE -> DB: Simpan adoption application (status: "Application Submitted")
    deactivate BE
    activate DB

    alt Application berhasil dibuat
        DB --> BE: Success (Application created)
        activate BE
        BE -> NS: Broadcast event "MessageSent" ke channel "notification.{user_id}
        activate NS
        NS -> FE_Adopter: Push notification "Congratulations! Your adoption has been completed"
        NS --> BE: Event broadcasted

        deactivate NS
        BE --> FE: 201 Created (Application detail)
        deactivate BE
        activate FE
        FE -> Adopter: Redirect ke halaman "Application Progress"
        deactivate FE

    else Gagal membuat application (DB error)
        DB --> BE: Error (e.g., constraint violation / connection failure)
        deactivate DB
        activate BE
        BE --> FE: 500 Internal Server Error ("Failed to create application")
        deactivate BE
        activate FE
        FE -> Adopter: Tampilkan pesan "Failed to create adoption application"
        deactivate FE
    end


' === Flow 2: Melihat Progress Adopsi ===
'Adopter -> FE: Buka halaman "My Applications"
'activate FE
'FE -> BE: GET /api/adoptions/user/{user_id}
'deactivate FE
'activate BE
'BE -> DB: Ambil semua adoption applications milik user
'activate DB
'DB --> BE: Return list of applications / null
'deactivate DB
'BE --> FE: 200 OK (List of applications dengan status)
'deactivate BE
'activate FE
'FE -> Adopter: Tampilkan daftar aplikasi adopsi dengan tahapan masing-masing
'deactivate FE
'
'note right of FE
'    Setiap tahapan memiliki use case tersendiri:
'
'    **UC-01: Upload Requirements**
'    - Adopter upload dokumen persyaratan
'    - Status berubah ke "Application Submitted"
'
'    **UC-02: Provider Review Application**
'    - Provider review & approve/reject
'    - Status berubah ke "Application Reviewed"
'
'    **UC-03: Schedule Meet & Greet**
'    - Provider tentukan jadwal pertemuan
'    - Status berubah ke "Meet & Greet Scheduled"
'
'    **UC-04: Complete Adoption**
'    - Adopter upload bukti hand over
'    - Status berubah ke "Completed"
'
'    Setiap use case akan memiliki
'    sequence diagram detail tersendiri
'end note

@enduml