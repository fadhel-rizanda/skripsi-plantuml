@startuml
' === Styling ===
skinparam sequence {
    LifelineFooterStrategy none
    MessageAlign center
    ArrowThickness 1
    ParticipantPadding 20
    GroupBorderThickness 0.5
    GroupBackgroundColor #F9F9F9
}
hide footbox

' === Participants ===
actor "Penyedia Hewan" as Provider
participant "Adoption Page (Next.js FE)" as FE
participant "RequirementController (Laravel BE)" as BE
database "Database (PostgreSQL)" as DB
participant "NotificationService (Laravel BE)" as NS
actor "Calon Pengadopsi" as FE_Adopter

' === Flow: Membuka Proses Adopsi ===
Provider -> FE: Buka halaman "Adoption Process"
activate FE
FE -> BE: GET /api/adoptions
deactivate FE
activate BE
BE -> DB: Ambil daftar proses adopsi aktif
activate DB
DB --> BE: Return list of adoption processes
deactivate DB
BE --> FE: 200 OK (Daftar proses adopsi)
deactivate BE
activate FE
FE -> Provider: Tampilkan daftar proses adopsi
deactivate FE

Provider -> FE: Pilih salah satu proses adopsi
activate FE
FE -> BE: GET /api/adoptions/{id}
deactivate FE
activate BE
BE -> DB: Ambil detail proses adopsi
activate DB
DB --> BE: Return adoption detail
deactivate DB
BE --> FE: 200 OK (Detail proses adopsi)
deactivate BE
activate FE
FE -> Provider: Tampilkan tab "Application Reviewed"
deactivate FE


' === Flow: Menentukan Requirement ===
Provider -> FE: Klik tombol "Set Requirement"
activate FE
FE -> FE: Tampilkan modal input (Name, Notes)
activate FE #LightBlue
deactivate FE #LightBlue

Provider -> FE: Isi requirement dan tekan "Save"
FE -> BE: POST /api/requirements {requirements[]}
deactivate FE
activate BE


    BE -> DB: Simpan semua requirement ke tabel requirements
    activate DB

    alt Berhasil menyimpan requirement
        DB --> BE: Success (Requirements saved)

        BE -> NS: Broadcast event "MessageSent" ke channel "notification.{user_id}
        activate NS
        NS -> FE_Adopter: Push notification "Requirements set by provider"
            NS --> BE: Event broadcasted
        deactivate NS
        BE --> FE: 201 Created (Daftar requirement terbaru)
        deactivate BE
        activate FE
        FE -> Provider: Tampilkan requirement yang telah ditentukan
        deactivate FE

    else Gagal menyimpan requirement (DB error)
        DB --> BE: Error response (e.g., constraint violation / connection failure)
        deactivate DB
        activate BE
        BE --> FE: 500 Internal Server Error ("Failed to set requirements")
        deactivate BE
        activate FE
        FE -> Provider: Tampilkan pesan "Failed to set requirements. Please try again."
        deactivate FE
end

@enduml
