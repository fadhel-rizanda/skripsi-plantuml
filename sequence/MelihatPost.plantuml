@startuml
' === Styling ===
skinparam sequence {
    LifelineFooterStrategy none
    MessageAlign center
    ArrowThickness 1
    ParticipantPadding 20
    GroupBorderThickness 0.5
    GroupBackgroundColor #F9F9F9
}
hide footbox

' === Participants ===
actor Pengguna
participant "Community Page (Next.js FE)" as FE
participant "PostController (Laravel BE)" as BE_Post
participant "TagController (Laravel BE)" as BE_Filter
participant "Cache (Redis)" as Redis
database "Database (PostgreSQL)" as DB

' === Normal Flow: Melihat Daftar Post ===
Pengguna -> FE: Klik menu "Community" pada navbar
activate FE

' --- Paralel Request ---
    FE -> BE_Post: GET /api/posts
    deactivate FE
    activate BE_Post
    BE_Post -> DB: Mengambil semua data post
    deactivate BE_Post
    activate DB
    alt Gagal memuat data post
    DB --> BE_Post: Return Empty list
    activate BE_Post
        BE_Post --> FE: 200 OK (Empty list)
        deactivate BE_Post
        activate FE
        FE -> Pengguna: Tampilkan pesan error "Failed to load posts"
        deactivate FE
    else Data post berhasil dimuat
        DB --> BE_Post: Return list of posts
    activate BE_Post
        deactivate DB
        BE_Post --> FE: 200 OK (List of posts)
        deactivate BE_Post
        activate FE
        FE -> Pengguna: Tampilkan daftar postingan

    FE -> BE_Filter: GET /api/tags
    activate BE_Filter
    BE_Filter -> Redis: GET cache:post_tags
    activate Redis

    alt Cache tersedia
        Redis --> BE_Filter: Return cached tags
        BE_Filter --> FE: 200 OK (Cached tags)
        deactivate BE_Filter
    else Cache kosong / expired
        Redis --> BE_Filter: Cache miss
        deactivate Redis
        activate BE_Filter
        BE_Filter -> DB: Mengambil semua data filter dari tabel referensi
        activate DB
        DB --> BE_Filter: Return filter data
        deactivate DB
        BE_Filter -> Redis: SET cache:post_tags (data, expired 1 jam)
        activate Redis
        Redis --> BE_Filter: OK
        deactivate Redis
        BE_Filter --> FE: 200 OK (Tags from DB)
        deactivate BE_Filter
    FE -> FE:Simpan filter di FE
    activate FE #LightBlue
    deactivate FE #LightBlue
end

activate FE
FE -> Pengguna: Tampilkan daftar postingan & opsi filter
deactivate FE


' === Flow: Menggunakan Pencarian / Filter ===
Pengguna -> FE: Masukkan kata kunci atau filter (kategori, tag, user)
activate FE
FE -> BE_Post: GET /api/posts?filter=...
deactivate FE
activate BE_Post
BE_Post -> DB: Mengambil semua data post berdasarkan filter
activate DB
DB --> BE_Post: Return filtered posts
deactivate DB
BE_Post --> FE: 200 OK (Filtered posts)
deactivate BE_Post
activate FE
FE -> Pengguna: Tampilkan hasil pencarian / filter
deactivate FE

' === Flow: Melihat Detail Post ===
Pengguna -> FE: Klik salah satu postingan dari daftar
activate FE
FE -> BE_Post: GET /api/posts/{post_id}
deactivate FE
activate BE_Post
BE_Post -> DB: Mengambil data post berdasarkan post_id
activate DB
DB --> BE_Post: Return post detail
deactivate DB

alt Post ditemukan
    BE_Post --> FE: 200 OK (Post detail)
    deactivate BE_Post
    activate FE
    FE -> Pengguna: Tampilkan halaman detail postingan
    deactivate FE

    ' === Subflow: Menampilkan Komentar ===
    FE -> BE_Post: GET /api/posts/{post_id}/comments
    activate BE_Post
    BE_Post -> DB: Mengambil semua data komentar berdasarkan post_id
    deactivate BE_Post
    activate DB
    DB --> BE_Post: Return list of comments
    activate BE_Post
    BE_Post --> FE: 200 OK (Comments list)
    deactivate BE_Post
    activate FE
    FE -> Pengguna: Tampilkan komentar & opsi interaksi (like, reply, share)
    deactivate FE

else Post tidak ditemukan / telah dihapus
DB --> BE_Post: Error (e.g., data not found / connection failure)
    deactivate DB
    activate BE_Post

    BE_Post --> FE: 404 Not Found ("Post not found")
    deactivate BE_Post
    activate FE
    FE -> Pengguna: Tampilkan pesan error "Post not found"
    deactivate FE
end
    end

@enduml